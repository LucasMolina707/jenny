<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Carta para ti</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-transition: 1.6s;
    }

    /* Importante: position relative para que ::after funcione */
    body {
      font-family: 'Inter', sans-serif;
      background-size: 200% 200%;
      transition: background-image var(--bg-transition) ease-in-out, background-color var(--bg-transition) ease-in-out;
      min-height: 100vh;
      margin: 0;
      position: relative; /* CORRECCI√ìN */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Visibilidad de pasos (inputs son hermanos de .container) */
    input[type="radio"] { display: none; }

    #step1-content { display: flex; flex-direction: column; align-items:center; }
    #step2-content, #step3-content { display: none; }

    /* reglas que activan las etapas */
    #step2:checked ~ .container #step1-content { display: none; }
    #step2:checked ~ .container #step2-content { display: flex; }
    #step3:checked ~ .container #step1-content,
    #step3:checked ~ .container #step2-content { display: none; }
    #step3:checked ~ .container #step3-content { display: flex; animation: pop-in 0.9s ease-out forwards; flex-direction: column; align-items:center; }

    @keyframes pop-in {
      0% { transform: scale(0.85) rotate(6deg); opacity: 0; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    /* Fondos din√°micos */
    .day-sky {
      background-image: linear-gradient(135deg, #87CEEB, #B0E0E6 60%, #FFD700 100%);
      animation: move-day-bg 20s ease-in-out infinite alternate;
    }
    @keyframes move-day-bg {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    .night-sky {
      background-image: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
      background-repeat: no-repeat;
      background-attachment: fixed;
      animation: twinkle 30s ease-in-out infinite alternate;
    }
    /* capa de estrellas usando pseudo-elemento del body (body tiene position:relative) */
    body.night-sky::after {
      content: '';
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
      opacity: 0.12;
      mix-blend-mode: screen;
      animation: move-stars 120s linear infinite;
    }
    @keyframes twinkle {
      0%,100% { opacity: 0.88; } 50% { opacity: 1; }
    }
    @keyframes move-stars {
      from { background-position: 0 0; } to { background-position: 1000px 500px; }
    }

    /* Ajustes para m√≥viles sobre emoji grande */
    .emoji-large { font-size: clamp(3.5rem, 9vw, 6rem); line-height:1; }

    /* Tarjeta final */
    .final-card {
      background: linear-gradient(180deg, rgba(245,242,255,0.95), rgba(238,230,255,0.9));
      border: 3px solid rgba(99,102,241,0.18);
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(15,23,42,0.12);
      max-width: 22rem;
      text-align: center;
    }

    /* Botones (extra) */
    .btn-main { padding: .65rem 1.6rem; border-radius: 999px; font-weight:700; }
  </style>
</head>
<body class="h-screen">

  <!-- pasos como inputs (sobresalen del container, siblings) -->
  <input type="radio" name="gift-steps" id="step1" checked>
  <input type="radio" name="gift-steps" id="step2">
  <input type="radio" name="gift-steps" id="step3">

  <main class="container flex justify-center items-center h-full w-full" role="main">
    <div class="content flex flex-col items-center justify-center space-y-8">

      <!-- Etapa 1 -->
      <section id="step1-content" class="flex-col items-center justify-center space-y-6" aria-hidden="false">
        <div id="greeting-message" class="text-3xl font-semibold text-gray-800" role="status" aria-live="polite">Oye mira...</div>
        <div class="emoji-large animate-pulse">üéÅ</div>
        <label for="step2" class="cursor-pointer inline-block bg-rose-500 text-white px-8 py-3 rounded-full shadow-lg hover:bg-rose-600 transition transform hover:scale-105 btn-main">
          Continuar
        </label>
      </section>

      <!-- Etapa 2 -->
      <section id="step2-content" class="flex-col items-center justify-center space-y-6" aria-hidden="true">
        <div class="text-3xl font-semibold text-gray-800">Ha llegado esto para ti</div>
        <label for="step3" class="emoji-large cursor-pointer transition-transform hover:scale-110" aria-label="Abrir carta">üíå</label>
        <div class="text-lg font-medium text-gray-700">Pulsa en la carta para abrir</div>
      </section>

      <!-- Etapa 3 -->
      <section id="step3-content" class="final-card" aria-hidden="true">
        <div id="final-message-text" class="text-2xl font-semibold text-gray-900 leading-tight">
          Cu√≠date‚ú®
          <br>o si no
          <br>con quien
          <br>me voy a
          <br>casar
        </div>
        <div class="text-4xl mt-2">üêß‚ù§Ô∏èüêß</div>
        <button id="listen-btn" class="mt-6 bg-indigo-600 text-white px-6 py-3 rounded-full shadow hover:bg-indigo-700 btn-main" type="button">
          Escuchar el mensaje ‚ú®
        </button>
      </section>

    </div>
  </main>

  <script>
    /*****************************************************************
     * L√≥gica: saludo + fondo seg√∫n hora
     *****************************************************************/
    function setDailyMood() {
      const body = document.body;
      const greetingElement = document.getElementById('greeting-message');
      const hour = new Date().getHours();

      if (hour >= 6 && hour < 19) {
        body.classList.remove('night-sky');
        body.classList.add('day-sky');
        greetingElement.textContent = '¬°Hola, buenos d√≠as!';
      } else {
        body.classList.remove('day-sky');
        body.classList.add('night-sky');
        greetingElement.textContent = '¬°Hola, buenas noches!';
      }
    }
    setDailyMood();
    // Actualiza saludo cada minuto por si el usuario deja la p√°gina abierta.
    setInterval(setDailyMood, 60_000);

    /*****************************************************************
     * TTS: fallback seguro con SpeechSynthesis del navegador.
     * Si quieres integrar una TTS remota (API), hazlo en el servidor
     * o usando fetch con CORS y luego reproducir el blob de audio.
     *****************************************************************/
    function speakFallback(text) {
      if (!('speechSynthesis' in window)) {
        alert('Tu navegador no soporta SpeechSynthesis. No se puede reproducir el mensaje.');
        return;
      }
      // configuraciones sencillas: voz, rate, pitch
      const utter = new SpeechSynthesisUtterance(text);
      // Opcional: elegir una voz en espa√±ol si est√° disponible
      const voices = window.speechSynthesis.getVoices();
      const esVoice = voices.find(v => /es(-|$)/i.test(v.lang)) || voices.find(v => /Spanish/i.test(v.name));
      if (esVoice) utter.voice = esVoice;
      utter.rate = 0.95;
      utter.pitch = 1.02;
      window.speechSynthesis.cancel(); // limpiar cola
      window.speechSynthesis.speak(utter);
    }

    // Handler del bot√≥n
    document.getElementById('listen-btn').addEventListener('click', () => {
      const text = document.getElementById('final-message-text').innerText;
      // Si quieres usar una API TTS externa, aqu√≠ es donde har√≠as la llamada fetch,
      // descargar√≠as el audio y lo reproducir√≠as; por ahora usamos el fallback local.
      speakFallback(text + ". Te quiero mucho.");
    });

    /*****************************************************************
     * Notas para integraci√≥n avanzada (si quieres):
     * - Si quieres TTS remoto (p. ej. OpenAI/Google), haz la petici√≥n desde
     *   tu backend (por seguridad de la API key) y devuelve un audio blob
     *   al frontend para reproducirlo. Evitas problemas de CORS y de exponer keys.
     * - Si deseas que el fondo cambie por clima real, usa Geolocation para
     *   obtener lat/lon y llama a OpenWeatherMap (requiere API key).
     *****************************************************************/
  </script>
</body>
</html>
